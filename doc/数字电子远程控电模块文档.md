# 数字电子远程智能控电模块

----------------

## 公共结构

### 1. 发送

发送结构

[帧头 1byte]
[序号 3byte]
[填充 3byte]
[帧头重复 1byte]
[命令 1byte]
[长度 1byte]
[数据 长度转10进制byte]
[校验 1byte]
[帧尾 1byte]

example:

``` c

68 // 帧头
80 13 10 // 终端编号
AA AA AA // 填充
68 // 帧头重复 命令开始
19 // 命令位
02 // 包长度
AA AA // 数据
E0 // sum8 校验 范围从0开始 到校验前一位 丢弃进位
16 // 帧尾

```

### 2. 返回

接收结构

[帧头 3byte]
[帧头 1byte]
[序号 3byte]
[填充 3byte]
[帧头重复 1byte]
[命令 1byte]
[长度 1byte]
[数据 长度转10进制byte]
[校验 1byte]
[帧尾 1byte]

example:

``` c

FF FF FF // 帧头
68 // 帧头
80 13 10 // 终端编号
AA AA AA // 填充
68 // 帧头重复 命令开始
99 // 命令位 = 发送命令 + 80
01 // 返回长度
55 // 数据
60 // sum8 校验 范围从1开始 到校验前一位 丢弃进位
16 // 帧尾

```

### 3. 备注

数据皆为大端序。低位在前。

float 采用 标准半精度浮点数（IEEE 754）。

## 命令部分

### 1. 解锁

``` c

send data

function code 19 // 命令位
length 02 // 包长度
data AA AA // 数据

recive data

function code 99 // 命令位 = 19 + 80
length 01
data 55

```

### 2. 读状态

``` c

send data

function code 07
length 00

recive data

function code 87 // 命令位 = 7 + 80
length 10
status code 01 00 // 正常开机 : 01 00 强制开机 : 02 00 关机 : 00 00
reason code 00 00 // 电量空 : 04 00 时段关机 : 05 00 强制关机 : 06 00 已锁定 : 07 00 未断电 00 00 未知状态 : 08 00   
voltage D1 D6 0C 45 // 电压 v = float / 10
current 8F C2 A6 43 // 电流 i = float / 1000
power 30 5D 6B 42 // 额定功率 p = float / 10 感性功率采样 p = vi

```

### 3. 强制关机

``` c

send data

function code 18
length 02
data AA AA

recive data // 返回同强制开机

function code 98 // 命令位 = 18 + 80
length 01
data 55

```

### 4. 强制开机

``` c

send data

function code 18
length 02
data 55 55

recive data // 返回同强制关机

function code 98 // 命令位 = 18 + 80
length 01
data 55

```

### 5. 恢复正常

``` c

send data

function code 18
length 02
data BB BB

recive data // 返回同强制关机

function code 98 // 命令位 = 18 + 80
length 01
data 55

```

### 6. 电量读取

``` c

send data

function code 02
length 00

recive data

function code 82 // 命令位 = 2 + 80
length 1C
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 充值电量 KWh = float / 10
kw/h 00 00 C8 42 // 初始电量 KWh = float / 10
kw/h 00 00 00 00 // 使用电量 KWh = float / 10
kw/h 00 00 C8 42 // 总电量 KWh = float / 10

```

## 设置部分

### 1. 基本参数设置

``` c

send data

function code 11
length 18
total power 00 40 1C 46 // 总功率 p = float / 10
reactive power 00 80 3B 45 // 阻性功率 p = float / 10
active power 00 68 1C 46 // 上电功率 p = float / 10
delay1 3C 00 // 延时1 integer
delay2 3D 00 // 延时2 integer
delay3 3E 00 // 延时3 integer
delay4 04 00 // 重试次数 integer

receive data

function code 91 // 命令位 11 + 80
length 01
data 55

```

### 2. 窗口参数设置

``` c

send data

function coda 13
length 10
window powerA 00 00 00 00 // 窗口A功率 p = float / 10
window powerB 00 00 00 00 // 窗口B功率 p = float / 10
window factorA 00 00 C8 42 // 窗口系数A p = float / 1000
window factorB 00 00 C8 42 // 窗口系数B p = float / 1000

receive data

function code 93 // 命令位 13 + 80
length 01
data 55

```

### 3. 时段参数设置

隔日操作，需要另一个时段进行 上电~闭电 时段配合。
例如 闭电 23:00~07:00 需要分割位 23:00~24:00 24:00~07:00。

``` c

send data

function coda 14
length 23
period 01 // 时段1 : 01 时段2 : 02 时段3 : 03 时段4 : 04 时段5 : 05 时段6 : 06 时段7 : 07
mode 01 00 // 时段工作模式 小功率 : 02 00 开关机 : 01 00 无模式 : 00 00
power 00 00 00 00 // 时段功率 p = float / 10 仅小功率模式生效
monday period halt 00 00 // 周一 闭电时间 时 分
monday period open 05 1E // 周一 上电时间 时 分
tuesday period halt 00 00 // 周二 闭电时间 时 分
tuesday period open 05 1E // 周二 上电时间 时 分
wednesday period halt 00 00 // 周三 闭电时间 时 分
wednesday period open 05 1E // 周三 上电时间 时 分
thursday period halt 00 00 // 周四 闭电时间 时 分
thursday period open 05 1E // 周四 上电时间 时 分
friday period halt 00 00 // 周五 闭电时间 时 分
friday period open 05 1E // 周五 上电时间 时 分
saturday period halt 00 00 // 周六 闭电时间 时 分
saturday period open 05 1E // 周六 上电时间 时 分
sunday period halt 00 00 // 周日 闭电时间 时 分
sunday period open 05 1E // 周日 上电时间 时 分

receive data

function code 94 // 命令位 14 + 80
length 01
data 55

```

### 4. 电量重置

``` c

send data

function code 12 // 命令位 = 2 + 80
length 1C
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 充值电量 KWh = float / 10
kw/h 00 00 C8 42 // 初始电量 KWh = float / 10
kw/h 00 00 00 00 // 使用电量 KWh = float / 10
kw/h 00 00 C8 42 // 总电量 KWh = float / 10

receive data

function code 92 // 命令位 12 + 80
length 01
data 55

```

### 5. 电量充值

命令同电量重置。

``` c

send data

function code 12 // 命令位 = 2 + 80
length 1C
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 电量 KWh = float / 10 用途未知
kw/h 00 00 00 00 // 充值电量 KWh = float / 10
kw/h 00 00 C8 42 // 初始电量 KWh = float / 10
kw/h 00 00 00 00 // 使用电量 KWh = float / 10
kw/h 00 00 C8 42 // 总电量 KWh = float / 10

receive data

function code 92 // 命令位 12 + 80
length 01
data 55

```

## 其他命令

### 1. 时间同步

时间同步没有返回。结构为 second, minute, hour, day, month, week, year 。

``` c

send data

function code 15
length 0E
second 30 30 // 00s int个位 int十位
minute 30 37 // 07m int个位 int十位
hour 31 37 // 17h int个位 int十位
day 30 31 // 01d int个位 int十位
mouth 30 38 // 08w int个位 int十位
week 30 31 // 01m int个位 int十位
year 30 35 // 05y int个位 int十位

```
